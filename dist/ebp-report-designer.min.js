!function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";var n=r(1),i=angular.module("ebp.report.designer",["ngResource",n.default.name,"ebp-ui","angular-yao-utils"]);Object.defineProperty(t,"__esModule",{value:!0}),t.default=i},function(e,t,r){"use strict";var n=r(2),i=r(3),o=r(4),s=r(5),a=r(6),l=r(7),c=r(9),d=r(10),p=r(11),u=r(33),f=r(36),v=angular.module("ebp.report.designer.core",[]);v.constant("defaultSettings",n.treeTableSettings).factory("reportDatasourceService",l.ReportDatasourceFactory).factory("reportService",c.ReportServiceFactory).factory("reportWidgetService",d.WidgetServiceFactory).controller("ChartPropsController",i.default).controller("TablePropsController",o.default).controller("DatasourcePropsController",s.default).controller("DatasourcePropsController",s.default).controller("ReportPreviewController",a.default).directive("ebpReportWidget",u.default).directive("ebpReportDesigner",p.default).directive("ebpReportList",f.default),v.run(["yaoGuid","$window",function(e,t){"ngInject";t.guid=e}]),Object.defineProperty(t,"__esModule",{value:!0}),t.default=v},function(e,t){"use strict";t.directiveNames={ebpTreeTable:"ebpTreetable",ebpTreeTableCol:"ebpTreetableCol",ebpTreeTableNode:"ebpTreetableNode",ebpTreeTableCell:"ebpTreetableCell",ebpTreeTableHeader:"columnheader"},t.treeTableSettings={expandAll:!1,colDefs:[],events:{edit:angular.noop,remove:angular.noop,add:angular.noop},dataSource:{read:null}}},function(e,t){"use strict";var r=function(){function e(e){"ngInject";e.$chart=e.$designer.selectedItem,e.config=e.$chart.config}return e.$inject=["$scope"],e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t){"use strict";var r=function(){function e(e,t){"ngInject";e.$table=e.$designer.selectedItem,e.config=e.$table.config||{};var r=e.$designer.report;e.fields=[],r.dataSource&&t.getFields(r.dataSource.seqId).then(function(t){e.fields=t,angular.isArray(e.config.displayFields)&&e.config.displayFields.forEach(function(t){var r=_.find(e.fields,{seqId:t.seqId});r&&(r.$checked=!0)})}),e.onFieldStatusChange=function(t){if(t.$checked){var r=$.extend({},t);delete r.$checked,e.config.displayFields.push(r)}else _.remove(e.config.displayFields,function(e){return e.seqId===t.seqId})}}return e.$inject=["$scope","reportDatasourceService"],e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t){"use strict";var r=function(){function e(e,t){"ngInject";var r=e.report=e.$designer.report;e.fields=[],r.dataSource&&t.getFields(r.dataSource.seqId).then(function(t){e.fields=t,angular.isArray(r.filterFields)&&r.filterFields.forEach(function(t){var r=_.find(e.fields,{seqId:t.seqId});r&&(r.$checked=!0)})}),e.dataSources=[],t.getDataSources().then(function(t){e.dataSources=t}),e.onDataSourceChange=function(n){r.filterFields=[],r.dataSource&&t.getFields(n.seqId).then(function(t){e.fields=t})},e.onFilterFieldStatusChange=function(e){if(e.$checked){var t=$.extend({},e);delete t.$checked,r.filterFields.push(t)}else _.remove(r.filterFields,function(t){return t.seqId===e.seqId})}}return e.$inject=["$scope","reportDatasourceService"],e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t){"use strict";var r=function(){function e(e,t,r,n,i){"ngInject";this.yaoFullscreen=t,this.$element=n,e.$report=r,this.yaoFullscreen=t,e.filterParams={},e.refreshReport=function(){e.$broadcast("ebp.report.refresh",{filterParams:e.filterParams})};var o={};angular.isArray(r.filterFields)&&r.filterFields.filter(function(e){return"select"===e.inputType}).forEach(function(e){var t=e.inputOptions.url;o[e.seqId]=i(t,{}).query()}),e.getOptionData=function(e){return o[e]},e.getWidget=function(e){return _.find(r.widgets,{id:e})}}return e.$inject=["$scope","yaoFullscreen","report","$element","$resource"],e.prototype.close=function(){this.yaoFullscreen.close()},e.prototype.exportHTML=function(){angular.download(this.$element.find(".report-wrapper")[0])},e.prototype.print=function(){window.print()},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t,r){"use strict";function n(e,t){function r(r){var n=t.defer(),o=i.default.getFieldsByDataSource;return e.get(o,{params:{dataSrcSeqId:r}}).then(function(e){n.resolve(e.data)},function(e){n.reject(e)}),n.promise}function n(){var r=t.defer(),n=i.default.getAllDataSource;return e.get(n).then(function(e){r.resolve(e.data)},function(e){r.reject(e)}),r.promise}return{getFields:r,getDataSources:n}}var i=r(8);t.ReportDatasourceFactory=n},function(e,t){"use strict";var r={getTableData:"/pms/project/report/getReportData",getChartData:"/pms/project/report/getReportData",getAllDataSource:"/plt/dataSource/getAllDataSrcSource",getFieldsByDataSource:"/plt/dataSource/queryItem",saveReportDef:"/plt/reportTpl/addReportTpl",getProjectTypes:"/pms/resources/codeitemtree/getTree?t=1479793526596&bizType=PRJTYPE",getDepartments:"/plt/formtpl/getOrgList",getReportList:"/plt/reportTpl/typebyIdList",getReportGroupList:"/plt/reportType/typeList"};Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t,r){"use strict";function n(e,t){function r(r){var n=t.defer(),o=i.default.saveReportDef;return e.post(o,{reportName:r.title,reportTypeSeqId:1,remark:"备注",reportDef:JSON.stringify(r)}).then(function(e){r.seqId=e.data.rtData.seqId,n.resolve(e.data)},function(e){n.reject(e)}),n.promise}function n(r){var n=t.defer(),o=i.default.getReportList;return e.get(o,{params:{typeSeqId:r}}).then(function(e){n.resolve(e.data)},function(e){n.reject(e)}),n.promise}function o(){var r=t.defer(),n=i.default.getReportGroupList;return e.get(n).then(function(e){r.resolve(e.data)},function(e){r.reject(e)}),r.promise}return{save:r,getReportList:n,getGroupList:o}}var i=r(8);t.ReportServiceFactory=n},function(e,t,r){"use strict";function n(e,t){function r(r){var n=t.defer(),o=i.default.getTableData;return e.get(o,{params:r}).then(function(e){n.resolve(e.data)},function(e){n.reject(e)}),n.promise}function n(r){var n=t.defer(),o=i.default.getChartData;return e.get(o,{params:r}).then(function(e){n.resolve(e.data)},function(e){n.reject(e)}),n.promise}return{getTableData:r,getChartData:n}}var i=r(8);t.WidgetServiceFactory=n},function(e,t,r){"use strict";function n(){function e(e,t,r,n){t.addClass("report-designer");var i=t.find(".report-wrapper"),o=i.find(".report-header");i.find(".report-body");o.on("click",function(e){o.toggleClass("active")}),t.on("contextmenu",function(){return n.widgetSelector.toggle(),e.$digest(),!1})}var t={restrict:"AE",link:e,templateUrl:"src/designer/templates/designer.tpl.html",controller:l,controllerAs:"$designer"};return t}var i=r(12),o=r(20),s=r(21),a=r(22),l=function(){function e(e,t,r,n){"ngInject";var a=this;this.widgetSelector=i.default.$invoke(this,{$scope:e,$element:t}),this.sidemenu=e.sidemenu=o.default.$invoke(this,{$scope:e,$element:t}),this.report=s.default.$invoke(this,{$scope:e,$element:t}),this.select=function(e){a.selectedItem&&a.selectedItem.element.removeClass("selected"),a.selectedItem=e,e.element.addClass("selected"),a.sidemenu.refresh()},this.preview=function(){r.open({templateUrl:"src/designer/templates/preview.tpl.html",controller:"ReportPreviewController",controllerAs:"$preview",resolve:{report:a.report}})},this.save=function(){n.save(a.report)}}return e.$inject=["$scope","$element","yaoFullscreen","reportService"],e.prototype.addBloc=function(){var e=new a.default(this.report);this.report.insertBloc(e)},e}();(function(){function e(e,t,r,n){"ngInject";this.yaoFullscreen=t,this.$element=n,e.$report=r}return e.$inject=["$scope","yaoFullscreen","report","$element"],e.prototype.close=function(){this.yaoFullscreen.close()},e.prototype.print=function(){print()},e.prototype.exportHTML=function(){angular.download(this.$element.find(".report-wrapper")[0])},e})();Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t,r){"use strict";function n(){var e=this,t=function(){function t(){var t=this;this.enable=!1,this.widgets=i,this.selectedWidget=i.BarChart,this.enable=!1,this.widgets=i,this.selectedWidget=i.BarChart,Object.defineProperties(e,{cursor:{get:function(){return t.enable?"cursor-"+t.selectedWidget.name:""}}})}return t.prototype.toggle=function(){this.enable=!this.enable},t.prototype.select=function(e){this.selectedWidget=e},t}();return new t}var i=r(13);Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}n(r(14)),n(r(17)),n(r(18)),n(r(19))},function(e,t,r){"use strict";var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=r(15),o=function(e){function t(){e.call(this),this.type=i.ChartType.BAR,this.name=t.name,this.title="柱状图"}return n(t,e),Object.defineProperty(t,"name",{get:function(){return"barchart"},enumerable:!0,configurable:!0}),t}(i.default);t.BarChart=o},function(e,t,r){"use strict";function n(){var e=this.$designer.sidemenu;e.changeTab(2,"src/designer/templates/charts-props.tpl.html"),this.$designer.select(this)}var i=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=r(16),s=function(e){function t(){e.call(this),this.category="chart",this.type=null,this.title="图表",this.config={title:"未命名图表",dataSource:{url:"",params:[]}}}return i(t,e),t.prototype.render=function(){return e.prototype.render.call(this),this.element.on("click",n.bind(this)),this.element},t}(o.default);t.ChartType={BAR:"bar",LINE:"line",PIE:"pie"},Object.defineProperty(t,"__esModule",{value:!0}),t.default=s},function(e,t){"use strict";var r=function(){function e(){this.id=guid(),this.category=null,this.name=null,this.title="组件";var e=$("<div>").addClass("report-widget"),t=null;Object.defineProperties(this,{element:{get:function(){return e}},report:{set:function(e){return t=e},get:function(){return t}}})}return e.prototype.render=function(){var e=this;this.element.attr("title",this.title),this.element.append($("<div>").addClass("widget-"+this.name));var t=$("<div>").addClass("widget-remove-button").on("click",function(){alert(2)}).hover(function(){e.element.addClass("warning")},function(){e.element.removeClass("warning")});return this.element.append(t),this.element},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t,r){"use strict";var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=r(15),o=function(e){function t(){e.call(this),this.type=i.ChartType.LINE,this.name=t.name,this.title="线图"}return n(t,e),Object.defineProperty(t,"name",{get:function(){return"linechart"},enumerable:!0,configurable:!0}),t}(i.default);t.LineChart=o},function(e,t,r){"use strict";var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=r(15),o=function(e){function t(){e.call(this),this.type=i.ChartType.PIE,this.name=t.name,this.title="饼图"}return n(t,e),Object.defineProperty(t,"name",{get:function(){return"piechart"},enumerable:!0,configurable:!0}),t}(i.default);t.PieChart=o},function(e,t,r){"use strict";function n(){var e=this.$designer.sidemenu;e.changeTab(2,"src/designer/templates/table-props.tpl.html"),this.$designer.select(this)}var i=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=r(16),s=function(e){function t(){e.call(this),this.category="table",this.name=t.name,this.title="表格",this.config={title:"未命名表格",dataSource:{url:"",params:[]},displayFields:[]}}return i(t,e),Object.defineProperty(t,"name",{get:function(){return"table"},enumerable:!0,configurable:!0}),t.prototype.render=function(){return e.prototype.render.call(this),this.element.on("click",n.bind(this)),this.element},t}(o.default);t.Table=s},function(e,t){"use strict";function r(e,t,r){"ngInject";var n=!1,i=[{id:1,title:"报表",view:{templateUrl:"src/designer/templates/report-props.tpl.html"}},{id:2,title:"数据",view:{templateUrl:"src/designer/templates/datasource-props.tpl.html"}},{id:3,view:{},title:"组件"}],o=i[0],s=function(){function s(){e.find(".designer-menu").on("click",function(e){return e.stopPropagation()})}return Object.defineProperty(s.prototype,"opened",{get:function(){return n},enumerable:!0,configurable:!0}),s.prototype.toggle=function(t){t.stopPropagation(),e.find(".menu-button").toggleClass("opened"),n=!n},Object.defineProperty(s.prototype,"tabs",{get:function(){return i},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"activeTab",{get:function(){return o},enumerable:!0,configurable:!0}),s.prototype.changeTab=function(e,r){"object"==typeof e&&(o=e),"number"==typeof e&&(o=i[e]),r&&(o.view={templateUrl:r}),t.$$phase||t.$apply()},s.prototype.refresh=function(){var e=o.view;o.view={templateUrl:""},t.$$phase||t.$apply(),r(function(){o.view=e},0)},s}();return new s}r.$inject=["$element","$scope","$timeout"],Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t){"use strict";function r(e,t){"ngInject";var r=function(){function r(){var t=this;$.extend(this,{title:"未命名报表",subtitle:"关于此报表的详细说明",blocs:[],widgets:[],getWidget:function(e){return _.find(t.widgets,{id:e})}}),Object.defineProperties(this,{$scope:{get:function(){return e}}})}return r.prototype.insertBloc=function(e){t.find(".report-body").append(e.render()),this.blocs.push(e)},r.prototype.insertBlocAfter=function(e,t){var r=$.inArray(e,this.blocs)+1;0===r?this.insertBloc(t):(t.render().insertAfter(e.element),this.blocs.splice(r,0,t))},r.prototype.removeBloc=function(t){var r=this,n=-1;(n=$.inArray(t,this.blocs))>-1&&e.$apply(function(){r.blocs.splice(n,1)})},r}(),n=new r,i=this;return Object.defineProperties(n,{$designer:{get:function(){return i}}}),n}r.$inject=["$scope","$element"],Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t,r){"use strict";function n(){var e=this,t=$("<div>").addClass("report-bloc-wrapper");return this.selectPane=new a(this),t.append(this.selectPane.render()),setTimeout(function(){e.selectPane.open()},0),$compile(t)(this.report.$scope),t}function i(){var e=this,t=$("<div>").addClass("select-pane assistant"),r=$('\n            <span class="pull-left">\n                <i class="fa fa-angle-left"></i>\n            </span>\n        '),n=$('\n            <span class="pull-right">\n                <i class="fa fa-angle-right"></i>\n            </span>\n        '),i=$("<div>").addClass("pane-title").append(r).append(n),s=$("<div>").addClass("pane-body"),a=$("<ul>").addClass("pane-h-list");return angular.forEach(o,function(t){var r=t.thumbnail;a.append($("<li>").html(r)),r.on("click",function(){e.bloc.layout=new t(e.bloc)})}),s.append(a),t.append(i).append(s),t.on("click",function(e){e.stopPropagation()}),r.on("click",function(){var e=parseInt(a.css("margin-left")),t=300,r=0;e+=t,e>r&&(e=r),a.stop(!0,!0).animate({"margin-left":e})}),n.on("click",function(){var e=parseInt(a.css("margin-left")),t=300,r=s.width()-a.width()+20;e-=t,e<r&&(e=r),a.stop(!0,!0).animate({"margin-left":e})}),$compile(t)(this.report.$scope),t}var o=r(23),s=function(){function e(t){var r=this,n=null;Object.defineProperties(this,{report:{get:function(){return t}},layout:{get:function(){return n},set:function(t){n&&r.removeLayout(),n=t;var i=$("<div>").addClass("add-bloc-btn").text("+").on("click",function(){var t=new e(r.report);r.report.insertBlocAfter(r,t)}),o=t.render();o.append(i),r.element.append(o)}}})}return e.prototype.render=function(){return this.element=n.bind(this).call(),this.element},e.prototype.destroy=function(){this.element.remove()},e.prototype.removeLayout=function(){this.layout.container.remove()},e.prototype.toJSON=function(){var e=$.extend({},this);return delete e.element,delete e.selectPane,e.layout=this.layout,e},e}(),a=function(){function e(e){Object.defineProperties(this,{bloc:{get:function(){return e}},report:{get:function(){return e.report}}})}return e.prototype.render=function(){return this.element=i.bind(this).call(),this.element},e.prototype.open=function(){var e=this;this.element.addClass("opened"),$(document).one("click",function(t){var r=$(t.target).parents().addBack();return!r.is(".select-pane")&&void(r.is(".report-designer")&&e.close())})},e.prototype.close=function(){var e=this;this.element.removeClass("opened"),this.bloc.layout||setTimeout(function(){e.bloc.destroy(),e.report.removeBloc(e.bloc)},500)},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=s},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}n(r(24)),n(r(28)),n(r(29)),n(r(30)),n(r(31)),n(r(32))},function(e,t,r){"use strict";var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=r(25),o=r(26),s=function(e){function t(t){e.call(this,t),this.addRow(new o.default(12,1))}return n(t,e),Object.defineProperty(t,"thumbnail",{get:function(){return $('\n            <div class="layout-thumbnail">\n                <div class="col-12"></div>\n            </div>\n        ')},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e=this;return angular.forEach(this.rows,function(t){e.container.append(t.render())}),this.container},t}(i.default);t.OneColumn=s},function(e,t){"use strict";function r(){var e=$("<div>").addClass("report-bloc");return e}var n=function(){function e(e){this.container=r(),this.rows=[],Object.defineProperties(this,{bloc:{get:function(){return e}}})}return e.prototype.render=function(){return this.container},e.prototype.addRow=function(e){var t=this;Object.defineProperties(e,{layout:{get:function(){return t}},$designer:{get:function(){return t.bloc.report.$designer}}}),this.rows.push(e)},e.prototype.toJSON=function(){var e=$.extend({},this);return delete e.container,e},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t,r){"use strict";function n(e,t){var r=this,n=$("<div>").addClass("report-row"),o=$("<div>").addClass("row-content"),s=[];if(e=e||12,Object.defineProperties(this,{cols:{get:function(){return s}},element:{get:function(){return n}}}),$.extend(this,{addColumn:function(e){Object.defineProperties(e,{$designer:{get:function(){return r.$designer}}}),s.push(e)},render:function(){return n.addClass("col-md-"+e).addClass(12===e?"no-padding":""),angular.forEach(s,function(e,t){return o.append(e.render(t))}),n.empty().append(o),n},changeColsTo:function(e){s.length=0;for(var t=0;t<e;t++){var n=new i.default(12/e);r.addColumn(n)}o.empty(),r.render()},toJSON:function(){var t=$.extend({},r);return t.cols=s,t.size=e,t}}),t)for(var a=0;a<t;a++){var l=new i.default(12/t);this.addColumn(l)}n.on({click:function(e){if(!$(e.target).parents().addBack().is(".report-widget")){var t=r.$designer.sidemenu;t.changeTab(2,"src/designer/templates/row-props.tpl.html"),r.$designer.select(r)}},mouseover:function(e){$(e.target).parents().addBack().is(".report-widget")?o.removeClass("hover-intent"):o.addClass("hover-intent")}}),o.hover(function(){o.addClass("hover-intent")},function(){o.removeClass("hover-intent")})}var i=r(27);Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t){"use strict";function r(e){var t=this,r=$("<div>").addClass("report-col"),n=$("<div>").addClass("col-content");e=e||12,Object.defineProperties(this,{size:{get:function(){return e}}}),$.extend(this,{render:function(t){return r.addClass("col-xs-"+e),r.addClass("num-"+t),r.empty().append(n),r},toJSON:function(){var r=$.extend({},t);return r.size=e,r}}),n.on("click",function(){var e=t.$designer.widgetSelector;if(e.enable){var r=new e.selectedWidget;t.$designer.report.widgets.push(r),r.report=t.$designer.report,t.content={id:r.id},Object.defineProperties(r,{$designer:{get:function(){return t.$designer}}}),n.html(r.render())}})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t,r){"use strict";var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=r(25),o=r(26),s=function(e){function t(t){e.call(this,t),this.addRow(new o.default(12,2))}return n(t,e),Object.defineProperty(t,"thumbnail",{get:function(){return $('\n            <div class="layout-thumbnail">\n                <div class="col-6"></div>\n                <div class="col-6"></div>\n            </div>\n        ')},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e=this;return angular.forEach(this.rows,function(t){e.container.append(t.render())}),this.container},t}(i.default);t.TwoColumn=s},function(e,t,r){"use strict";var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=r(25),o=r(26),s=function(e){function t(t){e.call(this,t),this.addRow(new o.default(12,3))}return n(t,e),Object.defineProperty(t,"thumbnail",{get:function(){return $('\n            <div class="layout-thumbnail">\n                <div class="col-4"></div>\n                <div class="col-4"></div>\n                <div class="col-4"></div>\n            </div>\n        ')},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e=this;return angular.forEach(this.rows,function(t){e.container.append(t.render())}),this.container},t}(i.default);t.ThreeColumn=s},function(e,t,r){"use strict";var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=r(25),o=r(26),s=function(e){function t(t){e.call(this,t),this.addRow(new o.default(12,4))}return n(t,e),Object.defineProperty(t,"thumbnail",{get:function(){return $('\n            <div class="layout-thumbnail">\n                <div class="col-3"></div>\n                <div class="col-3"></div>\n                <div class="col-3"></div>\n                <div class="col-3"></div>\n            </div>\n        ')},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e=this;return angular.forEach(this.rows,function(t){e.container.append(t.render())}),this.container},t}(i.default);t.FourColumn=s},function(e,t,r){"use strict";var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=r(25),o=r(26),s=r(27),a=function(e){function t(t){e.call(this,t);var r=new o.default(12);r.addColumn(new s.default(8)),r.addColumn(new s.default(4)),this.addRow(r)}return n(t,e),Object.defineProperty(t,"thumbnail",{get:function(){return $('\n            <div class="layout-thumbnail">\n                <div class="col-8"></div>\n                <div class="col-4"></div>\n            </div>\n        ')},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e=this;return angular.forEach(this.rows,function(t){e.container.append(t.render())}),this.container},t}(i.default);t.TwoToOne=a},function(e,t,r){"use strict";var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=r(25),o=r(26),s=r(27),a=function(e){function t(t){e.call(this,t);var r=new o.default(12);r.addColumn(new s.default(4)),r.addColumn(new s.default(8)),this.addRow(r)}return n(t,e),Object.defineProperty(t,"thumbnail",{get:function(){return $('\n            <div class="layout-thumbnail">\n                <div class="col-4"></div>\n                <div class="col-8"></div>\n            </div>\n        ')},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e=this;return angular.forEach(this.rows,function(t){e.container.append(t.render())}),this.container},t}(i.default);t.OneToTwo=a},function(e,t,r){"use strict";function n(){function e(e,t){var r=e.widget;return!!r&&void e.$on("yaoFullscreen.afterRender",function(){"chart"===r.category&&o.renderChart.$invoke(this,{scope:e,elem:t,widget:r}),"table"===r.category&&i.renderTable.$invoke(this,{scope:e,elem:t,widget:r})})}var t={restrict:"AE",link:e,scope:{widget:"=ebpReportWidget",report:"=report"}};return t}var i=r(34),o=r(35);(function(){function e(){}return e})();Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t){"use strict";function r(e,t,r,n,i){function o(n){angular.isObject(n)||(n={}),p.filterParams=n,i.getTableData(p).then(function(n){$.isPlainObject(e.$tableView.ebpTable)?(e.$tableView.tableData=n,t.empty().append(a),t.empty().append(r(l)(e))):e.$tableView.tableData=n})}function s(e){var t=[],r=e.config,n=r.displayFields;return n.forEach(function(e){var r={name:e.dataSrcItemName,title:e.dataSrcItemLabel,type:"field",dataType:"string"};t.push(r)}),{cols:t}}var a=$("<div>").addClass("report-widget-title").text(n.config.title),l=$("<div>",{"ebp-table":"$tableView.ebpTable",settings:"$tableView.widgetSettings","ng-model":"$tableView.tableData"}),c={colDefs:s(n)},d=e.report;e.$tableView={tableData:[],ebpTable:{},widgetSettings:c};var p={dataSrcId:d.seqId,widgetId:n.id};o(),e.$on("ebp.report.refresh",function(e,t){o(t.filterParams)}),setTimeout(function(){t.find(".ebp-table-content").on("scroll",function(){var e=$(this).prop("scrollLeft");t.find(".ebp-table-header").css({transform:"matrix(1, 0, 0, 1, "+-e+", 0)"})})},3e3)}t.renderTable=r},function(e,t){"use strict";function r(e,t,r,n){"ngInject";function i(e){angular.isObject(e)||(e={}),s.filterParams=e,n.getChartData(s).then(function(e){var n=e.data;t.height(400);var i=echarts.init(t[0]),o=r.config,s=[];n.length>0&&(s=n[0].datapoints.map(function(e){return e.x}));var a={title:{text:o.title},tooltip:{},legend:{data:n.map(function(e){return e.name}),bottom:0},toolbox:{feature:{magicType:{type:["stack","tiled"]},dataView:{},saveAsImage:{pixelRatio:2}}},xAxis:{data:s},yAxis:{},series:n.map(function(e){return{name:e.name,type:r.type,data:e.datapoints.map(function(e){return e.y})}})};i.setOption(a),$(window).on("resize",function(){i.resize()})})}var o=e.report,s={dataSrcId:o.seqId,widgetId:r.id};i(),e.$on("ebp.report.refresh",function(e,t){i(t.filterParams)})}r.$inject=["scope","elem","widget","reportWidgetService"],t.renderChart=r},function(e,t){"use strict";function r(){function e(){}var t={restrict:"AE",templateUrl:"src/designer/templates/list.tpl.html",link:e,controller:n};return t}var n=function(){function e(e,t,r){"ngInject";function n(){r.getReportList(e.selectedGroupId).then(function(t){e.reports=t})}e.reports=[],e.groups=[],e.selectedGroupId=1,n(),r.getGroupList().then(function(t){e.groups=t}),e.preview=function(e){t.open({templateUrl:"src/designer/templates/preview.tpl.html",controller:"ReportPreviewController",controllerAs:"$preview",resolve:{report:JSON.parse(e)}})},e.changeGroup=function(t){e.selectedGroupId=t.id,n()}}return e.$inject=["$scope","yaoFullscreen","reportService"],e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=r}]),angular.module("ebp.report.designer").run(["$templateCache",function(e){e.put("src/designer/templates/add.tpl.html",'<div ct-report-designer=""></div>'),e.put("src/designer/templates/charts-props.tpl.html",'<div class="chart-props" ng-controller="ChartPropsController"><div class="content-title"><span>{{$chart.title}}</span></div><div class="content-body"><div class="prop-group"><h1 class="square-blue">设置</h1><div class="form-group"><label class="prop-label col-sm-4" for="chartTitle">标题</label><div class="prop-control col-sm-8"><input class="prop-input" ng-model="config.title" id="chartTitle"></div></div></div></div></div>'),e.put("src/designer/templates/datasource-props.tpl.html",'<div class="row-props" ng-controller="DatasourcePropsController"><div class="content-title"><span>数据</span></div><div class="content-body"><div class="prop-group"><h1 class="square-blue">属性</h1><div class="form-group"><label class="prop-label col-sm-4" for="dataSource">数据来源</label><div class="prop-control col-sm-8"><select class="prop-select" id="dataSource" ng-change="onDataSourceChange(report.dataSource)" ng-model="report.dataSource" ng-options="i.dataSrcName for i in dataSources track by i.seqId"><option value="">-- 选择数据源 --</option></select></div></div></div><div class="prop-group"><h1 class="square-pink">可查询字段</h1><div class="form-group"><div class="prop-control col-sm-12"><label ng-repeat="field in fields"><input type="checkbox" ng-model="field.$checked" ng-change="onFilterFieldStatusChange(field)"> {{field.dataSrcItemLabel}}</label></div></div></div></div></div>'),e.put("src/designer/templates/designer.tpl.html",'<div class="designer-menu assistant" ng-class="{opened: sidemenu.opened}"><div class="menu-inner"><div class="menu-title"><ul class="nav-tabs"><li ng-class="{\'active\': sidemenu.activeTab.id === tab.id}" ng-repeat="tab in sidemenu.tabs track by tab.id"><a href="" ng-click="sidemenu.changeTab(tab)">{{tab.title}}</a></li></ul></div><div class="menu-content"><div class="nav-content"><div ng-include="sidemenu.activeTab.view.templateUrl"></div></div></div></div></div><div class="designer-content"><div class="designer-topbar assistant"><a ng-click="$designer.preview()" class="label label-primary"><i class="fa fa-eye"></i> 预览</a> <a class="label label-success" ng-click="$designer.save()"><i class="fa fa-save"></i> 保存</a> <a href="" class="pull-right" ng-click="sidemenu.toggle($event)"><span class="menu-button"></span></a></div><div class="report-wrapper" yao-scrollbar=""><div class="report-header"><h1><span yao-editable="$designer.report.title"></span></h1><h3 yao-editable="$designer.report.subtitle"></h3><span class="export-btn"><button class="btn btn-info">导出</button></span></div><div class="report-body" ng-class="[$designer.cursor]"><div ng-if="$designer.report.blocs.length <= 0" class="empty-prompt assistant" ng-click="$designer.addBloc()"><h3>没有组件!</h3><p>此处是报表设计的预览界面，当前还没有任何可用于预览的组件，点击添加组件。</p></div></div></div><div class="widget-selector" ng-show="$designer.widgetSelector.enable"><ul class="widget-shortcut-list"><li ng-click="$designer.widgetSelector.select(widget)" ng-class="{\'active\': $designer.widgetSelector.selectedWidget === widget}" ng-repeat="widget in $designer.widgetSelector.widgets"><span class="shortcut-icon {{widget.name}}-icon"></span></li><li><span class="shortcut-icon plus-icon"></span></li></ul></div></div>'),e.put("src/designer/templates/edit.tpl.html",'<div ct-report-designer="" report-id="$state.params.reportId"></div>'),e.put("src/designer/templates/list.tpl.html",'<div class="report-list-header"><div><h5 class="v-line-title">报表分组</h5><ul class="report-groups"><li ng-class="{active: selectedGroupId === group.id}" ng-repeat="group in groups track by group.id"><a ng-click="changeGroup(group)">{{group.name}}</a></li></ul><span class="pull-right"><span class="btn btn-light-grey"><i class="fa fa-refresh"></i>刷新</span> <button class="btn btn-info" ui-sref="collaborate.reports.add">创建报表</button></span></div><div><form class="form-inline"><select class="form-control"><option>按创建时间排序</option><option>按修改时间排序</option><option>按报表名称排序</option></select><div class="form-group"><input type="text" class="form-control text-input" placeholder="按报表名称搜索"></div><button class="btn btn-info">搜索</button></form></div></div><div class="report-list-body"><ul class="report-list"><li ng-repeat="report in reports track by report.id"><div class="report-list-item"><div class="item-title"><span>{{report.reportName}}</span></div><div class="item-actions"><span class="item-action"><a ui-sref="collaborate.reports.edit({reportId: 123})"><i class="fa fa-pencil"></i>修改</a></span> <span class="item-action" ng-click="preview(report.reportDef)"><i class="fa fa-eye"></i>查看</span> <span class="item-action"><i class="fa fa-external-link"></i>导出</span> <span class="item-action"><i class="fa fa-files-o"></i>复制</span> <span class="item-action red"><i class="fa fa-trash"></i>删除</span></div></div></li></ul></div>'),
e.put("src/designer/templates/preview.tpl.html",'<div class="report-preview" yao-scrollbar=""><pre>{{$report | json:3}}</pre><div class="report-wrapper"><div class="report-header"><h1>{{$report.title}}</h1><h3>{{$report.subtitle}}</h3><span class="export-btn"><button class="btn btn-info">导出</button></span></div><form name="filterForm" class="report-filter-form form-horizontal" ng-if="$report.filterFields.length > 0"><div class="col-md-6" ng-repeat="field in $report.filterFields"><div class="form-group"><label for="field-input-{{field.seqId}}" class="col-sm-4 control-label">{{field.dataSrcItemLabel}}:</label><div class="col-sm-8"><input type="text" ng-model="filterParams[field.dataSrcItemName]" name="{{field.dataSrcItemName}}" class="form-control" id="field-input-{{field.seqId}}" ng-if="field.inputType === \'text\'"><select class="form-control" ng-model="filterParams[field.dataSrcItemName]" name="{{field.dataSrcItemName}}" id="field-input-{{field.seqId}}" ng-if="field.inputType === \'select\'"><option value="">请选择</option><option value="{{o.name}}" ng-repeat="o in getOptionData(field.seqId)">{{o.name}}</option></select></div></div></div><div class="col-md-12"><button ng-click="refreshReport()" class="btn btn-success pull-right"><i class="fa fa-search"></i>查询</button></div></form><div class="report-body"><div class="report-bloc-wrapper" ng-repeat="bloc in $report.blocs"><div class="report-bloc"><div class="report-row col-md-{{row.size || 12}}" ng-class="{\'no-padding\': row.size === 12}" ng-repeat="row in bloc.layout.rows"><div class="row-content"><div class="report-col col-xs-{{col.size || 12}}" ng-repeat="col in row.cols"><div class="col-content"><div ebp-report-widget="getWidget(col.content.id)" report="$report"></div></div></div></div></div></div></div></div></div></div><div class="report-preview-actions"><button ng-click="$preview.close()" class="btn btn-sup btn-material-pink"><i class="fa fa-close"></i> 关闭</button> <button ng-click="$preview.print()" class="btn btn-sup btn-primary"><i class="fa fa-print"></i> 打印</button> <button ng-click="$preview.exportHTML()" class="btn btn-sup btn-success"><i class="fa fa-external-link"></i> 导出HTML文本</button></div>'),e.put("src/designer/templates/report-props.tpl.html",'<div class="row-props"><div class="content-title"><span>报表</span></div><div class="content-body"><div class="prop-group"><h1 class="square-blue">属性</h1><div class="form-group"><label class="prop-label col-sm-4" for="reportTitle">标题</label><div class="prop-control col-sm-8"><input class="prop-input" ng-model="$designer.report.title" id="reportTitle"></div></div><div class="form-group"><label class="prop-label col-sm-4" for="reportSubtitle">说明</label><div class="prop-control col-sm-8"><textarea class="prop-textarea" ng-model="$designer.report.subtitle" id="reportSubtitle"></textarea></div></div></div></div></div>'),e.put("src/designer/templates/row-props.tpl.html",'<div class="row-props"><div class="content-title"><span>行</span></div><div class="content-body"><div class="prop-group"><h1 class="square-blue">样式</h1><div class="form-group" ng-init="selected = $designer.selectedItem.cols.length"><label class="prop-label col-sm-4" for="columnsSel">列数</label><div class="prop-control col-sm-8"><select class="prop-select" id="columnsSel" ng-change="$designer.selectedItem.changeColsTo(selected)" ng-model="selected" ng-options="i for i in [1,2,3,4,6]"></select></div></div></div></div></div>'),e.put("src/designer/templates/table-props.tpl.html",'<div class="chart-props" ng-controller="TablePropsController"><div class="content-title"><span>{{$table.title}}</span></div><div class="content-body"><div class="prop-group"><h1 class="square-blue">设置</h1><div class="form-group"><label class="prop-label col-sm-4" for="tableTitle">标题</label><div class="prop-control col-sm-8"><input class="prop-input" ng-model="config.title" id="tableTitle"></div></div></div><div class="prop-group"><h1 class="square-pink">表头属性</h1><div class="form-group"><div class="prop-control col-sm-12"><label ng-repeat="field in fields"><input type="checkbox" ng-model="field.$checked" ng-change="onFieldStatusChange(field)"> {{field.dataSrcItemLabel}}</label></div></div></div></div></div>')}]);